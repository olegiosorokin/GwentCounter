<!DOCTYPE html>
<html>
<head>
    <title>–°—á—ë—Ç—á–∏–∫ –ì–≤–∏–Ω—Ç</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background: #1a1a2e;
            color: white;
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .header {
            background: linear-gradient(145deg, #16213e, #1a1a3a);
            border-radius: 25px;
            padding: 20px;
            border: 2px solid #e94560;
            box-shadow: 0 6px 0 #0f0f1f;
        }

        .total-score {
            font-size: 64px;
            font-weight: bold;
            color: #0ff;
            text-align: center;
            text-shadow: 0 0 20px #0ff;
            line-height: 1;
        }

        .weather-indicator {
            text-align: center;
            font-size: 18px;
            margin-top: 8px;
            min-height: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .weather-badge {
            background: #0f3460;
            padding: 6px 16px;
            border-radius: 30px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .weather-badge.melee {
            border-left: 4px solid #87CEEB;
        }

        .weather-badge.ranged {
            border-left: 4px solid #B0C4DE;
        }

        .weather-badge.siege {
            border-left: 4px solid #4682B4;
        }

        .round-info {
            text-align: center;
            color: #888;
            font-size: 16px;
            margin-top: 8px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .badge {
            background: #0f3460;
            padding: 4px 12px;
            border-radius: 30px;
            color: white;
        }

        /* –†—è–¥—ã */
        .rows-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .row-card {
            background: linear-gradient(145deg, #16213e, #1f1a3a);
            border-radius: 25px;
            padding: 16px;
            border: 2px solid #533483;
            box-shadow: 0 5px 0 #0f0f1f;
        }

        .row-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
            background: #0f3460;
            padding: 12px 16px;
            border-radius: 20px;
        }

        .row-title {
            font-size: 22px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .row-total {
            font-size: 28px;
            font-weight: bold;
            color: #0ff;
        }

        /* –ö–∞—Ä—Ç—ã */
        .cards-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }

        .card-item {
            background: #0f3460;
            border-radius: 20px;
            padding: 12px 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            border: 2px solid #533483;
        }

        .card-item.hero {
            background: linear-gradient(145deg, #2a1b3d, #2a1a4a);
            border: 3px solid gold;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .card-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .card-power {
            font-size: 24px;
            font-weight: bold;
            color: #0ff;
            min-width: 50px;
            text-align: center;
        }

        .card-name {
            font-size: 18px;
            font-weight: 500;
        }

        .card-abilities {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .ability-tag {
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .ability-morale {
            background: #ff6b6b;
            color: white;
            box-shadow: 0 2px 0 #b34747;
        }

        .ability-horn {
            background: #ffd700;
            color: #1a1a2e;
            box-shadow: 0 2px 0 #b39700;
        }

        .ability-friend {
            background: #9b59b6;
            color: white;
            box-shadow: 0 2px 0 #6c3b8a;
        }

        .hero-tag {
            background: gold;
            color: #1a1a2e;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: bold;
            border: 1px solid white;
        }

        .card-calculation {
            background: #0a1a2a;
            padding: 10px 12px;
            border-radius: 15px;
            font-size: 14px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            border: 1px solid #533483;
        }

        .calc-step {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #aaa;
        }

        .calc-step.final {
            color: #0ff;
            font-weight: bold;
        }

        .calc-arrow {
            color: #ffd700;
            font-size: 18px;
        }

        .remove-card {
            background: #f44336;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 3px 0 #aa2e25;
            transition: all 0.1s;
            flex-shrink: 0;
        }

        .remove-card:active {
            transform: translateY(3px);
            box-shadow: none;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç—ã —Ä—è–¥–∞ */
        .row-effects {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #533483;
        }

        .effect-btn {
            background: #0f3460;
            border: 2px solid #533483;
            padding: 12px 20px;
            border-radius: 40px;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            min-width: 120px;
            justify-content: center;
            box-shadow: 0 3px 0 #0f0f1f;
        }

        .effect-btn.active {
            background: #e94560;
            border-color: #ff6b6b;
            box-shadow: 0 0 20px #e94560;
        }

        .effect-btn.horn.active {
            background: #ffd700;
            color: #1a1a2e;
        }

        .effect-btn.weather-melee.active {
            background: #87CEEB;
            color: #1a1a2e;
        }

        .effect-btn.weather-ranged.active {
            background: #B0C4DE;
            color: #1a1a2e;
        }

        .effect-btn.weather-siege.active {
            background: #4682B4;
            color: white;
        }

        .effect-btn:active {
            transform: translateY(3px);
            box-shadow: none;
        }

        /* –ü–∞–Ω–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è */
        .add-panel {
            background: linear-gradient(145deg, #16213e, #1a1a3a);
            border-radius: 30px;
            padding: 20px;
            border: 2px solid #e94560;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .input-group input, .input-group select {
            flex: 1;
            min-width: 120px;
            padding: 16px 20px;
            background: #0f3460;
            border: 2px solid #533483;
            border-radius: 30px;
            color: white;
            font-size: 16px;
            -webkit-appearance: none;
        }

        .abilities-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .ability-checkbox {
            flex: 1;
            min-width: 120px;
            background: #0f3460;
            border: 2px solid #533483;
            border-radius: 30px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ability-checkbox input[type="checkbox"] {
            width: 22px;
            height: 22px;
            accent-color: #e94560;
        }

        .ability-checkbox:has(input:checked) {
            background: #1f4a7a;
            border-color: #e94560;
        }

        .add-button {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 18px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 5px 0 #2d6a31;
            cursor: pointer;
            transition: all 0.1s;
            width: 100%;
        }

        .add-button:active {
            transform: translateY(5px);
            box-shadow: none;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .action-btn {
            padding: 18px;
            border-radius: 30px;
            border: none;
            font-size: 20px;
            font-weight: bold;
            color: white;
            box-shadow: 0 5px 0 rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.1s;
        }

        .action-btn:active {
            transform: translateY(5px);
            box-shadow: none;
        }

        .action-btn.end {
            background: #4CAF50;
        }

        .action-btn.reset {
            background: #f44336;
        }

        /* –ò—Å—Ç–æ—Ä–∏—è */
        .history-panel {
            background: #16213e;
            border-radius: 25px;
            padding: 16px;
            border: 2px solid #533483;
        }

        .history-title {
            font-size: 16px;
            margin-bottom: 10px;
            color: #888;
        }

        .history-list {
            max-height: 120px;
            overflow-y: auto;
            font-size: 14px;
        }

        .history-item {
            padding: 6px 0;
            border-bottom: 1px solid #533483;
            color: #ccc;
        }

        @media (max-width: 480px) {
            .total-score { font-size: 52px; }
            .card-main { flex-wrap: wrap; }
            .card-left { width: 100%; }
            .remove-card { margin-left: auto; }
            .effect-btn { min-width: 100%; }
            .ability-checkbox { min-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="header">
            <div class="total-score" id="totalScore">0</div>
            <div class="weather-indicator" id="weatherIndicator"></div>
            <div class="round-info">
                <span class="badge" id="roundDisplay">–†–∞—É–Ω–¥ 1</span>
                <span class="badge" id="cardsCountDisplay">–ö–∞—Ä—Ç: 0</span>
            </div>
        </div>

        <!-- –†—è–¥—ã -->
        <div class="rows-container" id="rowsContainer"></div>

        <!-- –ü–∞–Ω–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç—ã -->
        <div class="add-panel">
            <div class="input-group">
                <input type="number" id="cardPower" placeholder="–°–∏–ª–∞" min="0" value="5">
                <select id="cardRow">
                    <option value="melee">‚öîÔ∏è –ë–ª–∏–∂–Ω–∏–π –±–æ–π</option>
                    <option value="ranged">üèπ –î–∞–ª—å–Ω–∏–π –±–æ–π</option>
                    <option value="siege">üè∞ –û—Å–∞–¥–Ω—ã–π —Ä—è–¥</option>
                </select>
            </div>

            <div class="input-group">
                <input type="text" id="cardName" placeholder="–ò–º—è –∫–∞—Ä—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ë–∞—Ä–¥)" value="">
            </div>

            <div class="abilities-group">
                <label class="ability-checkbox">
                    <input type="checkbox" id="isHero"> üëë –ì–µ—Ä–æ–π (–∏–º–º—É–Ω–∏—Ç–µ—Ç)
                </label>
                <label class="ability-checkbox">
                    <input type="checkbox" id="hasMorale"> ‚≠ê –ú–æ—Ä–∞–ª—å (+1 –¥—Ä—É–≥–∏–º)
                </label>
                <label class="ability-checkbox">
                    <input type="checkbox" id="hasHorn"> üìØ –†–æ–≥ (—É–¥–≤–∞–∏–≤–∞–µ—Ç –¥—Ä—É–≥–∏—Ö)
                </label>
                <label class="ability-checkbox">
                    <input type="checkbox" id="isFriend"> ü§ù –î—Ä—É–∑—å—è (√ó –∫–æ–ª-–≤–æ)
                </label>
            </div>

            <button class="add-button" onclick="addCard()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É</button>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="action-buttons">
            <button class="action-btn end" onclick="endRound()">üèÅ –†–∞—É–Ω–¥</button>
            <button class="action-btn reset" onclick="resetGame()">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è -->
        <div class="history-panel">
            <div class="history-title">üìã –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π</div>
            <div class="history-list" id="historyList"></div>
        </div>
    </div>

    <script>
        class GwentAccurateCounter {
            constructor() {
                this.round = 1;
                this.cards = {
                    melee: [],
                    ranged: [],
                    siege: []
                };
                this.horn = { melee: false, ranged: false, siege: false };
                this.weather = { melee: false, ranged: false, siege: false };
                this.history = [];

                // –ë–ï–ó –î–ï–ú–û-–ö–ê–†–¢ - –ø—É—Å—Ç–æ–π —Å—Ç–∞—Ä—Ç
            }

            addCard(power, row, isHero, hasMorale, hasHorn, isFriend, customName) {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ
                let name = customName;
                if (!name) {
                    if (isHero) name = '–ì–µ—Ä–æ–π';
                    else if (hasMorale) name = '–ö–æ–º–∞–Ω–¥–∏—Ä';
                    else if (hasHorn) name = '–ë–∞—Ä–¥';
                    else if (isFriend) name = '–°–æ–ª–¥–∞—Ç';
                    else name = '–í–æ–∏–Ω';
                }

                const card = {
                    id: Date.now(),
                    name: name,
                    power: parseInt(power),
                    isHero: isHero,
                    hasMorale: hasMorale,
                    hasHorn: hasHorn,
                    isFriend: isFriend,
                };

                this.cards[row].push(card);

                let desc = `${card.name} (${power}) –≤ ${this.getRowName(row)}`;
                if (isHero) desc += ' üëë';
                if (hasMorale) desc += ' ‚≠ê';
                if (hasHorn) desc += ' üìØ';
                if (isFriend) desc += ' ü§ù';

                this.addToHistory(`‚ûï ${desc}`);
                this.updateDisplay();
            }

            removeCard(row, id) {
                const index = this.cards[row].findIndex(c => c.id === id);
                if (index !== -1) {
                    const card = this.cards[row][index];
                    this.cards[row].splice(index, 1);
                    this.addToHistory(`‚ùå ${card.name} —É–¥–∞–ª–µ–Ω–∞`);
                    this.updateDisplay();
                }
            }

            toggleHorn(row) {
                this.horn[row] = !this.horn[row];
                const rowNames = { melee: '–±–ª–∏–∂–Ω–µ–º', ranged: '–¥–∞–ª—å–Ω–µ–º', siege: '–æ—Å–∞–¥–Ω–æ–º' };
                this.addToHistory(`üìØ –†–æ–≥ ${this.horn[row] ? '–≤–∫–ª—é—á–µ–Ω' : '–≤—ã–∫–ª—é—á–µ–Ω'} –≤ ${rowNames[row]} —Ä—è–¥—É`);
                this.updateDisplay();
            }

            toggleWeather(row) {
                this.weather[row] = !this.weather[row];

                const weatherNames = {
                    melee: { name: '‚ùÑÔ∏è –ú–æ—Ä–æ–∑', on: '—É–¥–∞—Ä–∏–ª', off: '–æ—Ç—Å—Ç—É–ø–∏–ª' },
                    ranged: { name: 'üå´Ô∏è –¢—É–º–∞–Ω', on: '–æ–ø—É—Å—Ç–∏–ª—Å—è', off: '—Ä–∞—Å—Å–µ—è–ª—Å—è' },
                    siege: { name: 'üåßÔ∏è –î–æ–∂–¥—å', on: '–ø–æ—à—ë–ª', off: '–∫–æ–Ω—á–∏–ª—Å—è' }
                };

                const w = weatherNames[row];
                this.addToHistory(`${w.name} ${this.weather[row] ? w.on : w.off} –≤ ${this.getRowName(row)} —Ä—è–¥—É`);
                this.updateDisplay();
            }

            calculateCardPower(card, rowCards, rowHasHorn, rowHasWeather) {
                if (card.isHero) {
                    return {
                        final: card.power,
                        steps: [`üëë –ì–µ—Ä–æ–π: ${card.power} (–∏–º–º—É–Ω–∏—Ç–µ—Ç)`]
                    };
                }

                let currentPower = card.power;
                let steps = [];

                // 1. –ü–û–ì–û–î–ê (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –¥–æ 1)
                if (rowHasWeather) {
                    currentPower = 1;
                    steps.push(`üåßÔ∏è –ü–æ–≥–æ–¥–∞: 1`);
                }

                // 2. –ú–û–†–ê–õ–¨ (+1 –∑–∞ –∫–∞–∂–¥—É—é –∫–∞—Ä—Ç—É —Å –º–æ—Ä–∞–ª—å—é –≤ —Ä—è–¥—É, –∫—Ä–æ–º–µ —Å–µ–±—è)
                const moraleCount = rowCards.filter(c => c.hasMorale && !c.isHero && c.id !== card.id).length;
                if (moraleCount > 0) {
                    currentPower += moraleCount;
                    steps.push(`‚≠ê –ú–æ—Ä–∞–ª—å +${moraleCount}: ${currentPower}`);
                }

                // 3. –î–†–£–ó–¨–Ø (—É–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–∫–∏—Ö –∂–µ)
                if (card.isFriend) {
                    const friendCount = rowCards.filter(c => c.isFriend && !c.isHero).length;
                    if (friendCount > 1) {
                        currentPower = currentPower * friendCount;
                        steps.push(`ü§ù –î—Ä—É–∑—å—è x${friendCount}: ${currentPower}`);
                    }
                }

                // 4. –†–û–ì
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —ç—Ñ—Ñ–µ–∫—Ç —Ä–æ–≥–∞ –¥–ª—è —ç—Ç–æ–π –∫–∞—Ä—Ç—ã
                const hasHornEffect = rowHasHorn; // –æ–±—â–∏–π —Ä–æ–≥
                const hasCardHorn = card.hasHorn; // –∫–∞—Ä—Ç–∞ —Å–∞–º–∞ –¥–∞–µ—Ç —Ä–æ–≥

                if (hasHornEffect) {
                    // –û–±—â–∏–π —Ä–æ–≥ –¥–µ–π—Å—Ç–≤—É–µ—Ç –Ω–∞ –≤—Å–µ—Ö
                    currentPower = currentPower * 2;
                    steps.push(`üìØ –û–±—â–∏–π —Ä–æ–≥ √ó2: ${currentPower}`);
                } else if (hasCardHorn) {
                    // –ö–∞—Ä—Ç–∞ —Å —Ä–æ–≥–æ–º –ù–ï —É–¥–≤–∞–∏–≤–∞–µ—Ç —Å–µ–±—è
                    steps.push(`üìØ –°–≤–æ–π —Ä–æ–≥ (–Ω–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç –Ω–∞ —Å–µ–±—è)`);
                }

                return {
                    final: currentPower,
                    steps: steps
                };
            }

            calculateRow(row) {
                const rowCards = this.cards[row];
                if (rowCards.length === 0) return { total: 0, cards: [] };

                const rowHasHorn = this.horn[row];
                const rowHasWeather = this.weather[row];
                const results = [];

                // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ —Ä—è–¥—É –∫–∞—Ä—Ç–∞ —Å —Ä–æ–≥–æ–º
                const hasCardHorn = rowCards.some(c => c.hasHorn && !c.isHero);

                rowCards.forEach(card => {
                    const calc = this.calculateCardPower(card, rowCards, rowHasHorn, rowHasWeather);

                    // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–∞—Ä—Ç–∞ —Å —Ä–æ–≥–æ–º, –ø—Ä–∏–º–µ–Ω—è–µ–º –µ—ë —ç—Ñ—Ñ–µ–∫—Ç –∫ –î–†–£–ì–ò–ú –∫–∞—Ä—Ç–∞–º
                    if (hasCardHorn && !rowHasHorn && !card.hasHorn && !card.isHero) {
                        // –ö–∞—Ä—Ç–∞ —Å —Ä–æ–≥–æ–º —É–¥–≤–∞–∏–≤–∞–µ—Ç –¥—Ä—É–≥–∏—Ö
                        calc.final = calc.final * 2;
                        calc.steps.push(`üìØ –ë–∞—Ä–¥ —É–¥–≤–∞–∏–≤–∞–µ—Ç: ${calc.final}`);
                    }

                    results.push({
                        ...card,
                        finalPower: calc.final,
                        steps: calc.steps
                    });
                });

                const total = results.reduce((sum, card) => sum + card.finalPower, 0);

                return {
                    total: total,
                    cards: results
                };
            }

            calculateTotal() {
                return this.calculateRow('melee').total +
                       this.calculateRow('ranged').total +
                       this.calculateRow('siege').total;
            }

            updateDisplay() {
                const rows = ['melee', 'ranged', 'siege'];
                const rowNames = { melee: '–ë–ª–∏–∂–Ω–∏–π', ranged: '–î–∞–ª—å–Ω–∏–π', siege: '–û—Å–∞–¥–Ω—ã–π' };
                const rowEmoji = { melee: '‚öîÔ∏è', ranged: 'üèπ', siege: 'üè∞' };

                const weatherNames = {
                    melee: '‚ùÑÔ∏è –ú–æ—Ä–æ–∑',
                    ranged: 'üå´Ô∏è –¢—É–º–∞–Ω',
                    siege: 'üåßÔ∏è –î–æ–∂–¥—å'
                };

                const container = document.getElementById('rowsContainer');
                container.innerHTML = '';

                rows.forEach(row => {
                    const rowData = this.calculateRow(row);

                    let rowHtml = `
                        <div class="row-card">
                            <div class="row-header">
                                <div class="row-title">
                                    ${rowEmoji[row]} ${rowNames[row]}
                                </div>
                                <div>
                                    <span class="row-total">${rowData.total}</span>
                                </div>
                            </div>

                            <div class="cards-container">
                    `;

                    rowData.cards.forEach(card => {
                        rowHtml += `
                            <div class="card-item ${card.isHero ? 'hero' : ''}">
                                <div class="card-main">
                                    <div class="card-left">
                                        <span class="card-power">${card.finalPower}</span>
                                        <span class="card-name">${card.name}</span>
                                        <div class="card-abilities">
                                            ${card.isHero ? '<span class="hero-tag">üëë –ì–µ—Ä–æ–π</span>' : ''}
                                            ${card.hasMorale ? '<span class="ability-tag ability-morale">‚≠ê –ú–æ—Ä–∞–ª—å</span>' : ''}
                                            ${card.hasHorn ? '<span class="ability-tag ability-horn">üìØ –†–æ–≥</span>' : ''}
                                            ${card.isFriend ? '<span class="ability-tag ability-friend">ü§ù –î—Ä—É–∑—å—è</span>' : ''}
                                        </div>
                                    </div>
                                    <div class="remove-card" onclick="removeCard('${row}', ${card.id})">‚úñ</div>
                                </div>
                                <div class="card-calculation">
                                    ${card.steps.map(step => `<span class="calc-step">${step}</span>`).join('<span class="calc-arrow"> ‚Üí </span>')}
                                    <span class="calc-step final">= ${card.finalPower}</span>
                                </div>
                            </div>
                        `;
                    });

                    const weatherClass = row === 'melee' ? 'weather-melee' : (row === 'ranged' ? 'weather-ranged' : 'weather-siege');

                    rowHtml += `
                            </div>

                            <div class="row-effects">
                                <div class="effect-btn ${this.horn[row] ? 'active horn' : ''}"
                                     onclick="toggleHorn('${row}')">
                                    üìØ –†–æ–≥ ${this.horn[row] ? '‚úì' : ''}
                                </div>
                                <div class="effect-btn ${weatherClass} ${this.weather[row] ? 'active' : ''}"
                                     onclick="toggleWeather('${row}')">
                                    ${weatherNames[row]} ${this.weather[row] ? '‚úì' : ''}
                                </div>
                            </div>
                        </div>
                    `;

                    container.innerHTML += rowHtml;
                });

                // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–∏–π —Å—á–µ—Ç
                document.getElementById('totalScore').textContent = this.calculateTotal();

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–≥–æ–¥—ã
                this.updateWeatherIndicator();

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                const totalCards = this.cards.melee.length + this.cards.ranged.length + this.cards.siege.length;
                document.getElementById('roundDisplay').textContent = `–†–∞—É–Ω–¥ ${this.round}`;
                document.getElementById('cardsCountDisplay').textContent = `–ö–∞—Ä—Ç: ${totalCards}`;
            }

            updateWeatherIndicator() {
                const weatherNames = {
                    melee: '‚ùÑÔ∏è –ú–æ—Ä–æ–∑',
                    ranged: 'üå´Ô∏è –¢—É–º–∞–Ω',
                    siege: 'üåßÔ∏è –î–æ–∂–¥—å'
                };

                let activeWeather = [];

                if (this.weather.melee) activeWeather.push(`<span class="weather-badge melee">‚ùÑÔ∏è –ú–æ—Ä–æ–∑</span>`);
                if (this.weather.ranged) activeWeather.push(`<span class="weather-badge ranged">üå´Ô∏è –¢—É–º–∞–Ω</span>`);
                if (this.weather.siege) activeWeather.push(`<span class="weather-badge siege">üåßÔ∏è –î–æ–∂–¥—å</span>`);

                const indicator = document.getElementById('weatherIndicator');

                if (activeWeather.length > 0) {
                    indicator.innerHTML = activeWeather.join(' ');
                } else {
                    indicator.innerHTML = '<span style="color: #888;">‚òÄÔ∏è –Ø—Å–Ω–æ</span>';
                }
            }

            endRound() {
                const total = this.calculateTotal();
                this.addToHistory(`üèÅ –†–∞—É–Ω–¥ ${this.round} –∑–∞–≤–µ—Ä—à–µ–Ω! –°—á–µ—Ç: ${total}`);
                this.round++;

                // –û—á–∏—â–∞–µ–º –∫–∞—Ä—Ç—ã –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã
                this.cards = { melee: [], ranged: [], siege: [] };
                this.horn = { melee: false, ranged: false, siege: false };
                this.weather = { melee: false, ranged: false, siege: false };

                this.updateDisplay();
            }

            resetGame() {
                this.round = 1;
                this.cards = { melee: [], ranged: [], siege: [] };
                this.horn = { melee: false, ranged: false, siege: false };
                this.weather = { melee: false, ranged: false, siege: false };
                this.history = [];

                this.addToHistory('üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞');
                this.updateDisplay();
            }

            addToHistory(message) {
                const time = new Date().toLocaleTimeString();
                this.history.push(`${time}: ${message}`);
                if (this.history.length > 10) this.history.shift();

                const historyList = document.getElementById('historyList');
                historyList.innerHTML = this.history.map(msg =>
                    `<div class="history-item">${msg}</div>`
                ).join('');
            }

            getRowName(row) {
                const names = { melee: '–±–ª–∏–∂–Ω–µ–º', ranged: '–¥–∞–ª—å–Ω–µ–º', siege: '–æ—Å–∞–¥–Ω–æ–º' };
                return names[row];
            }
        }

        // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä—É
        const game = new GwentAccurateCounter();
        game.updateDisplay();

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        function addCard() {
            const power = document.getElementById('cardPower').value;
            const row = document.getElementById('cardRow').value;
            const isHero = document.getElementById('isHero').checked;
            const hasMorale = document.getElementById('hasMorale').checked;
            const hasHorn = document.getElementById('hasHorn').checked;
            const isFriend = document.getElementById('isFriend').checked;
            const customName = document.getElementById('cardName').value;

            if (power > 0) {
                game.addCard(power, row, isHero, hasMorale, hasHorn, isFriend, customName);

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–ª—è
                document.getElementById('cardPower').value = '5';
                document.getElementById('cardName').value = '';
                document.getElementById('isHero').checked = false;
                document.getElementById('hasMorale').checked = false;
                document.getElementById('hasHorn').checked = false;
                document.getElementById('isFriend').checked = false;
            }
        }

        function removeCard(row, id) {
            game.removeCard(row, id);
        }

        function toggleHorn(row) {
            game.toggleHorn(row);
        }

        function toggleWeather(row) {
            game.toggleWeather(row);
        }

        function endRound() {
            game.endRound();
        }

        function resetGame() {
            game.resetGame();
        }
    </script>
</body>
</html>
