<!DOCTYPE html>
<html>
<head>
    <title>–ì–≤–∏–Ω—Ç –°—á–µ—Ç—á–∏–∫</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, 'Helvetica Neue', 'Segoe UI', Roboto, Arial, sans-serif;
        }

        body {
            background: #f0ebe5;
            min-height: 100vh;
            padding: 12px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å - —Å–≤–µ—Ç–ª–∞—è –∏ —á–∏—Å—Ç–∞—è */
        .header {
            background: #ffffff;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #e5ddd5;
        }

        .total-score {
            font-size: 48px;
            font-weight: 600;
            color: #2c3e50;
            text-align: center;
            line-height: 1.2;
        }

        .weather-row {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 8px 0;
            flex-wrap: wrap;
        }

        .weather-badge {
            background: #f5f0eb;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            color: #5a6b7a;
            border: 1px solid #d5cec5;
        }

        .round-info {
            display: flex;
            justify-content: center;
            gap: 16px;
            font-size: 15px;
            color: #7f8c8d;
            border-top: 1px solid #e5ddd5;
            padding-top: 8px;
            margin-top: 4px;
        }

        /* –ü–∞–Ω–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è */
        .add-panel {
            background: #ffffff;
            border-radius: 16px;
            padding: 16px;
            border: 1px solid #e5ddd5;
        }

        .add-row {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
        }

        .power-select, .row-select {
            background: #f8f4f0;
            border: 1px solid #d5cec5;
            border-radius: 24px;
            padding: 12px 16px;
            font-size: 15px;
            color: #2c3e50;
            -webkit-appearance: none;
        }

        .power-select {
            width: 80px;
            text-align: center;
        }

        .row-select {
            flex: 1;
        }

        .ability-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .ability-btn {
            background: #f8f4f0;
            border: 1px solid #d5cec5;
            border-radius: 30px;
            padding: 10px 12px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            color: #2c3e50;
            flex: 1;
            min-width: 70px;
            justify-content: center;
            transition: all 0.1s;
        }

        .ability-btn.active {
            background: #e3f2fd;
            border-color: #90caf9;
        }

        .ability-btn.hero.active { background: #fff3e0; border-color: #ffb74d; }
        .ability-btn.morale.active { background: #e8f5e9; border-color: #81c784; }
        .ability-btn.horn.active { background: #fff8e1; border-color: #ffd54f; }
        .ability-btn.friend.active { background: #f3e5f5; border-color: #ba68c8; }

        .add-btn {
            background: #2c3e50;
            border: none;
            border-radius: 30px;
            padding: 14px;
            color: white;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            transition: background 0.1s;
        }

        .add-btn:active {
            background: #1a2632;
        }

        /* –†—è–¥—ã */
        .rows-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .row-card {
            background: #ffffff;
            border-radius: 16px;
            padding: 12px;
            border: 1px solid #e5ddd5;
        }

        .row-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f4f0;
            padding: 10px 12px;
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .row-title {
            font-size: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            color: #2c3e50;
        }

        .row-total {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .cards-container {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .card-item {
            background: #f8f4f0;
            border-radius: 12px;
            padding: 8px 12px;
            border: 1px solid #d5cec5;
            cursor: pointer;
        }

        .card-item.hero {
            background: #fff8e7;
            border-color: #e0cba0;
        }

        .card-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-power {
            font-size: 18px;
            font-weight: 600;
            min-width: 35px;
            text-align: center;
            transition: color 0.2s;
        }

/* –¶–≤–µ—Ç–∞ —Å–∏–ª—ã - –±–æ–ª–µ–µ —è—Ä–∫–∏–µ –∏ —Ä–∞–∑–ª–∏—á–∏–º—ã–µ */
.power-normal {
    color: #2c3e50;
}

.power-buffed {
    color: #2e7d32;
    font-weight:600;
}

.power-debuffed {
    color: #c62828;
    font-weight:600;
}

.power-hero {
    color: #bf6f00;
    font-weight:600;
}

/* –î–ª—è —Ä—è–¥–∞ - –º–µ–Ω—è–µ–º —Ü–≤–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ –ø—Ä–∏ –±–∞—Ñ—Ñ–∞—Ö */
.row-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f8f4f0;
    padding: 10px 12px;
    border-radius: 12px;
    margin-bottom: 8px;
    transition: all 0.2s;
}

.row-header.buffed {
    background: #e8f5e9;
    border-left: 4px solid #2e7d32;
}

.row-header.debuffed {
    background: #ffebee;
    border-left: 4px solid #c62828;
}

.row-header.hero-row {
    background: #fff3e0;
    border-left: 4px solid #bf6f00;
}

/* –ò—Ç–æ–≥ —Ä—è–¥–∞ */
.row-total {
    font-size: 20px;
    font-weight: 600;
    color: #2c3e50;
    transition: color 0.2s;
}

.row-total.buffed {
    color: #2e7d32;
}

.row-total.debuffed {
    color: #c62828;
}

.row-total.hero-row {
    color: #bf6f00;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∏ */
.card-item {
    background: #f8f4f0;
    border-radius: 12px;
    padding: 8px 12px;
    border: 1px solid #d5cec5;
    cursor: pointer;
    transition: all 0.1s;
}

.card-item.hero {
    background: #fff8e7;
    border-color: #e0cba0;
}

.card-main {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-left {
    display: flex;
    align-items: center;
    gap: 10px;
}

.card-power {
    font-size: 18px;
    font-weight: 600;
    min-width: 35px;
    text-align: center;
    transition: color 0.2s;
}

.card-name {
    font-size: 15px;
    color: #2c3e50;
}

.card-badges {
    display: flex;
    gap: 4px;
}

.mini-badge {
    width: 24px;
    height: 24px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    background: white;
    border: 1px solid #d5cec5;
}

.card-details {
    display: none;
    margin-top: 8px;
    padding: 8px;
    background: white;
    border-radius: 8px;
    font-size: 13px;
    color: #5a6b7a;
    border: 1px solid #e5ddd5;
}

.card-item.expanded .card-details {
    display: block;
}

.calc-line {
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
}

.calc-line.final {
    color: #2c3e50;
    font-weight: 500;
    margin-top: 4px;
    border-top: 1px solid #e5ddd5;
    padding-top: 4px;
}

.remove-btn {
    background: white;
    color: #95a5a6;
    width: 32px;
    height: 32px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    cursor: pointer;
    border: 1px solid #d5cec5;
    transition: all 0.1s;
}

.remove-btn:active {
    background: #fee;
    color: #e74c3c;
}

/* –≠—Ñ—Ñ–µ–∫—Ç—ã —Ä—è–¥–∞ */
.row-effects {
    display: flex;
    gap: 8px;
    margin-top: 8px;
}

.effect-btn {
    background: #f8f4f0;
    border: 1px solid #d5cec5;
    border-radius: 24px;
    padding: 10px;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    flex: 1;
    justify-content: center;
    color: #2c3e50;
    transition: all 0.1s;
}

.effect-btn.active {
    background: #e3f2fd;
    border-color: #90caf9;
}

.effect-btn.horn.active {
    background: #fff8e1;
    border-color: #ffd54f;
}

.effect-btn.weather.active {
    background: #e1f5fe;
    border-color: #81d4fa;
}

/* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
.action-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
}

.action-btn {
    padding: 14px;
    border-radius: 30px;
    border: 1px solid #d5cec5;
    font-size: 16px;
    font-weight: 500;
    color: #2c3e50;
    background: white;
    cursor: pointer;
    transition: background 0.1s;
}

.action-btn:active {
    background: #f0ebe5;
}

.action-btn.end { background: #e8f5e9; }
.action-btn.reset { background: #ffebee; }

/* –ò—Å—Ç–æ—Ä–∏—è */
.history-panel {
    background: white;
    border-radius: 16px;
    padding: 12px;
    border: 1px solid #e5ddd5;
}

.history-title {
    font-size: 14px;
    color: #7f8c8d;
    margin-bottom: 6px;
}

.history-list {
    max-height: 80px;
    overflow-y: auto;
    font-size: 13px;
}

.history-item {
    padding: 4px 0;
    color: #5a6b7a;
    border-bottom: 1px solid #f0ebe5;
}
    </style>
</head>
<body>
    <div class="container">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="header">
            <div class="total-score" id="totalScore">0</div>
            <div class="weather-row" id="weatherRow"></div>
            <div class="round-info">
                <span>–†–∞—É–Ω–¥ <span id="roundDisplay">1</span></span>
                <span>–ö–∞—Ä—Ç: <span id="cardsCountDisplay">0</span></span>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
        <div class="add-panel">
            <div class="add-row">
                <select class="power-select" id="cardPower">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5" selected>5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                </select>

                <select class="row-select" id="cardRow">
                    <option value="melee">‚öîÔ∏è –ë–ª–∏–∂–Ω–∏–π</option>
                    <option value="ranged">üèπ –î–∞–ª—å–Ω–∏–π</option>
                    <option value="siege">üè∞ –û—Å–∞–¥–Ω—ã–π</option>
                </select>
            </div>

            <div class="ability-buttons">
                <button class="ability-btn hero" id="btnHero" onclick="toggleAbility('hero')">üëë –ì–µ—Ä–æ–π</button>
                <button class="ability-btn morale" id="btnMorale" onclick="toggleAbility('morale')">‚≠ê –ü—Ä–∏–ª–∏–≤ —Å–∏–ª</button>
                <button class="ability-btn horn" id="btnHorn" onclick="toggleAbility('horn')">üìØ –ë–∞—Ä–¥</button>
                <button class="ability-btn friend" id="btnFriend" onclick="toggleAbility('friend')">ü§ù –ü–ª–æ—Ç–Ω—ã–π —Å—Ç—Ä–æ–π</button>
            </div>

            <button class="add-btn" onclick="addCard()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É</button>
        </div>

        <!-- –†—è–¥—ã -->
        <div class="rows-container" id="rowsContainer"></div>

        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="action-buttons">
            <button class="action-btn end" onclick="endRound()">üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞—É–Ω–¥</button>
            <button class="action-btn reset" onclick="resetGame()">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è -->
        <div class="history-panel">
            <div class="history-title">üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
            <div class="history-list" id="historyList"></div>
        </div>
    </div>

    <script>
        class GwentCounter {
            constructor() {
                this.round = 1;
                this.cards = { melee: [], ranged: [], siege: [] };
                this.horn = { melee: false, ranged: false, siege: false };
                this.weather = { melee: false, ranged: false, siege: false };
                this.history = [];

                this.selectedAbilities = {
                    hero: false,
                    morale: false,
                    horn: false,
                    friend: false
                };
            }

            toggleAbility(type) {
                this.selectedAbilities[type] = !this.selectedAbilities[type];

                if (type === 'hero' && this.selectedAbilities.hero) {
                    this.selectedAbilities.morale = false;
                    this.selectedAbilities.horn = false;
                    this.selectedAbilities.friend = false;
                }

                document.getElementById('btnHero').classList.toggle('active', this.selectedAbilities.hero);
                document.getElementById('btnMorale').classList.toggle('active', this.selectedAbilities.morale);
                document.getElementById('btnHorn').classList.toggle('active', this.selectedAbilities.horn);
                document.getElementById('btnFriend').classList.toggle('active', this.selectedAbilities.friend);
            }

            generateName() {
                if (this.selectedAbilities.hero) return '–ì–µ—Ä–æ–π';
                if (this.selectedAbilities.morale) return '–ü—Ä–∏–ª–∏–≤ —Å–∏–ª';
                if (this.selectedAbilities.horn) return '–ë–∞—Ä–¥';
                if (this.selectedAbilities.friend) return '–ü–ª–æ—Ç–Ω—ã–π —Å—Ç—Ä–æ–π';
                return '–í–æ–∏–Ω';
            }

            addCard() {
                const power = parseInt(document.getElementById('cardPower').value);
                const row = document.getElementById('cardRow').value;

                const card = {
                    id: Date.now(),
                    power: power,
                    basePower: power,
                    isHero: this.selectedAbilities.hero,
                    hasMorale: this.selectedAbilities.morale,
                    hasHorn: this.selectedAbilities.horn,
                    isFriend: this.selectedAbilities.friend,
                    name: this.generateName()
                };

                this.cards[row].push(card);

                let desc = `${card.name} (${power})`;
                if (card.isHero) desc += ' üëë';
                if (card.hasMorale) desc += ' ‚≠ê';
                if (card.hasHorn) desc += ' üìØ';
                if (card.isFriend) desc += ' ü§ù';

                this.addToHistory(`‚ûï ${desc}`);

                this.selectedAbilities = { hero: false, morale: false, horn: false, friend: false };
                ['btnHero', 'btnMorale', 'btnHorn', 'btnFriend'].forEach(id => {
                    document.getElementById(id).classList.remove('active');
                });

                this.updateDisplay();
            }

            removeCard(row, id) {
                const index = this.cards[row].findIndex(c => c.id === id);
                if (index !== -1) {
                    const card = this.cards[row][index];
                    this.cards[row].splice(index, 1);
                    this.addToHistory(`‚ùå ${card.name}`);
                    this.updateDisplay();
                }
            }

            toggleCardDetails(id) {
                const element = document.getElementById(`card-${id}`);
                if (element) {
                    element.classList.toggle('expanded');
                }
            }

            toggleHorn(row) {
                this.horn[row] = !this.horn[row];
                this.updateDisplay();
            }

            toggleWeather(row) {
                this.weather[row] = !this.weather[row];
                this.updateDisplay();
            }

            calculateCardPower(card, rowCards, rowHasHorn, rowHasWeather) {
    // –ì–µ—Ä–æ–∏ —Ç–µ–ø–µ—Ä—å –º–æ–≥—É—Ç –¥–∞–≤–∞—Ç—å –º–æ—Ä–∞–ª—å, –Ω–æ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç –µ—ë
    if (card.isHero) {
        // –ì–µ—Ä–æ–π –≤—Å—ë –µ—â—ë –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –±–æ–Ω—É—Å—ã
        return {
            final: card.power,
            steps: ['üëë –ì–µ—Ä–æ–π: ' + card.power],
            change: 0
        };
    }

    let currentPower = card.power;
    let steps = [];
    let change = 0;

    // 1. –ü–æ–≥–æ–¥–∞ (–Ω–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç –Ω–∞ –≥–µ—Ä–æ–µ–≤, –Ω–æ –º—ã —É–∂–µ –≤ –≤–µ—Ç–∫–µ –Ω–µ-–≥–µ—Ä–æ–µ–≤)
    if (rowHasWeather) {
        currentPower = 1;
        steps.push('üåßÔ∏è –ü–æ–≥–æ–¥–∞: 1');
        change = - (card.power - 1);
    }

    // 2. –ú–æ—Ä–∞–ª—å - —Å—á–∏—Ç–∞–µ–º –í–°–ï –∫–∞—Ä—Ç—ã —Å –º–æ—Ä–∞–ª—å—é, –≤–∫–ª—é—á–∞—è –≥–µ—Ä–æ–µ–≤!
    // –¢–µ–ø–µ—Ä—å —É—á–∏—Ç—ã–≤–∞–µ–º –∏ –≥–µ—Ä–æ–µ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞—é—Ç –º–æ—Ä–∞–ª—å
    const moraleCount = rowCards.filter(c =>
        (c.hasMorale) && // –º–æ–∂–µ—Ç –±—ã—Ç—å –≥–µ—Ä–æ–π —Å –º–æ—Ä–∞–ª—å—é –∏–ª–∏ –æ–±—ã—á–Ω–∞—è –∫–∞—Ä—Ç–∞
        c.id !== card.id // –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ–º —Å–∞–º—É –∫–∞—Ä—Ç—É
    ).length;

    if (moraleCount > 0) {
        currentPower += moraleCount;
        steps.push(`‚≠ê –ú–æ—Ä–∞–ª—å +${moraleCount}: ${currentPower}`);
        change += moraleCount;
    }

    // 3. –î—Ä—É–∑—å—è
    if (card.isFriend) {
        const friendCount = rowCards.filter(c => c.isFriend && !c.isHero).length;
        if (friendCount > 1) {
            const before = currentPower;
            currentPower = currentPower * friendCount;
            steps.push(`ü§ù –î—Ä—É–∑—å—è x${friendCount}: ${currentPower}`);
            change += (currentPower - before);
        }
    }

    // 4. –†–æ–≥
    if (rowHasHorn) {
        const before = currentPower;
        currentPower = currentPower * 2;
        steps.push(`üìØ –û–±—â–∏–π —Ä–æ–≥ √ó2: ${currentPower}`);
        change += (currentPower - before);
    } else if (card.hasHorn) {
        steps.push(`üìØ –°–≤–æ–π —Ä–æ–≥ (–∂–¥—ë—Ç)`);
    }

    return { final: currentPower, steps: steps, change: change };
}

            calculateRow(row) {
    const rowCards = this.cards[row];
    if (rowCards.length === 0) return { total: 0, cards: [], state: 'normal' };

    const rowHasHorn = this.horn[row];
    const rowHasWeather = this.weather[row];
    const hasCardHorn = rowCards.some(c => c.hasHorn && !c.isHero);
    const results = [];

    // –°—á–∏—Ç–∞–µ–º –∫–∞—Ä—Ç—ã
    rowCards.forEach(card => {
        const calc = this.calculateCardPower(card, rowCards, rowHasHorn, rowHasWeather);

        if (hasCardHorn && !rowHasHorn && !card.hasHorn && !card.isHero) {
            const before = calc.final;
            calc.final = calc.final * 2;
            calc.steps.push(`üìØ –ë–∞—Ä–¥ —É–¥–≤–∞–∏–≤–∞–µ—Ç: ${calc.final}`);
            calc.change += (calc.final - before);
        }

        results.push({
            ...card,
            finalPower: calc.final,
            steps: calc.steps,
            change: calc.change
        });
    });

    const total = results.reduce((sum, card) => sum + card.finalPower, 0);

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä—è–¥–∞ (–¥–ª—è —Ü–≤–µ—Ç–∞)
    let state = 'normal';
    const hasHero = results.some(c => c.isHero);
    const hasBuffed = results.some(c => c.finalPower > c.power);
    const hasDebuffed = results.some(c => c.finalPower < c.power);

    if (hasHero && results.every(c => c.isHero || c.finalPower === c.power)) {
        state = 'hero'; // –µ—Å–ª–∏ –≤—Å–µ –∫–∞—Ä—Ç—ã –∏–ª–∏ –≥–µ—Ä–æ–∏ –∏–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    } else if (hasDebuffed && !hasBuffed) {
        state = 'debuffed'; // –µ—Å–ª–∏ –µ—Å—Ç—å –æ—Å–ª–∞–±–ª–µ–Ω–Ω—ã–µ –∏ –Ω–µ—Ç —É—Å–∏–ª–µ–Ω–Ω—ã—Ö
    } else if (hasBuffed) {
        state = 'buffed'; // –µ—Å–ª–∏ –µ—Å—Ç—å —É—Å–∏–ª–µ–Ω–Ω—ã–µ
    }

    return {
        total: total,
        cards: results,
        state: state
    };
}

            calculateTotal() {
                return this.calculateRow('melee').total +
                       this.calculateRow('ranged').total +
                       this.calculateRow('siege').total;
            }

            getPowerColor(card) {
                if (card.isHero) return 'power-hero';
                if (card.finalPower > card.power) return 'power-buffed';
                if (card.finalPower < card.power) return 'power-debuffed';
                return 'power-normal';
            }

            updateDisplay() {
    const rows = ['melee', 'ranged', 'siege'];
    const rowNames = { melee: '‚öîÔ∏è –ë–ª–∏–∂–Ω–∏–π', ranged: 'üèπ –î–∞–ª—å–Ω–∏–π', siege: 'üè∞ –û—Å–∞–¥–Ω—ã–π' };
    const weatherIcons = { melee: '‚ùÑÔ∏è', ranged: 'üå´Ô∏è', siege: 'üåßÔ∏è' };

    const container = document.getElementById('rowsContainer');
    container.innerHTML = '';

    rows.forEach(row => {
        const rowData = this.calculateRow(row);

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Ä—è–¥–∞
        let headerClass = 'row-header';
        let totalClass = 'row-total';

        if (rowData.state === 'buffed') {
            headerClass += ' buffed';
            totalClass += ' buffed';
        } else if (rowData.state === 'debuffed') {
            headerClass += ' debuffed';
            totalClass += ' debuffed';
        } else if (rowData.state === 'hero') {
            headerClass += ' hero-row';
            totalClass += ' hero-row';
        }

        let rowHtml = `
            <div class="row-card">
                <div class="${headerClass}">
                    <span class="row-title">${rowNames[row]}</span>
                    <span class="${totalClass}">${rowData.total}</span>
                </div>

                <div class="cards-container">
        `;

                    rowData.cards.forEach(card => {
                        const badges = [];
                        if (card.isHero) badges.push('<span class="mini-badge">üëë</span>');
                        if (card.hasMorale) badges.push('<span class="mini-badge">‚≠ê</span>');
                        if (card.hasHorn) badges.push('<span class="mini-badge">üìØ</span>');
                        if (card.isFriend) badges.push('<span class="mini-badge">ü§ù</span>');

                        const powerColor = this.getPowerColor(card);

                        rowHtml += `
                            <div class="card-item ${card.isHero ? 'hero' : ''}" id="card-${card.id}" onclick="toggleCardDetails(${card.id})">
                                <div class="card-main">
                                    <div class="card-left">
                                        <span class="card-power ${powerColor}">${card.finalPower}</span>
                                        <span class="card-name">${card.name}</span>
                                        <div class="card-badges">${badges.join('')}</div>
                                    </div>
                                    <div class="remove-btn" onclick="event.stopPropagation(); removeCard('${row}', ${card.id})">‚úñ</div>
                                </div>
                                <div class="card-details">
                                    <div class="calc-line">
                                        ${card.steps.map(step => `<span>${step}</span>`).join(' ‚Üí ')}
                                    </div>
                                    <div class="calc-line final">= ${card.finalPower}</div>
                                </div>
                            </div>
                        `;
                    });

                    rowHtml += `
                            </div>

                            <div class="row-effects">
                                <button class="effect-btn ${this.horn[row] ? 'active horn' : ''}"
                                        onclick="toggleHorn('${row}')">
                                    üìØ –†–æ–≥
                                </button>
                                <button class="effect-btn ${this.weather[row] ? 'active weather' : ''}"
                                        onclick="toggleWeather('${row}')">
                                    ${weatherIcons[row]} ${this.weather[row] ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–ü–æ–≥–æ–¥–∞'}
                                </button>
                            </div>
                        </div>
                    `;

                    container.innerHTML += rowHtml;
                });

                document.getElementById('totalScore').textContent = this.calculateTotal();
                this.updateWeatherDisplay();

                const totalCards = this.cards.melee.length + this.cards.ranged.length + this.cards.siege.length;
                document.getElementById('roundDisplay').textContent = this.round;
                document.getElementById('cardsCountDisplay').textContent = totalCards;
            }

            updateWeatherDisplay() {
                const weatherRow = document.getElementById('weatherRow');

                let active = [];
                if (this.weather.melee) active.push(`<span class="weather-badge">‚ùÑÔ∏è –ú–æ—Ä–æ–∑</span>`);
                if (this.weather.ranged) active.push(`<span class="weather-badge">üå´Ô∏è –¢—É–º–∞–Ω</span>`);
                if (this.weather.siege) active.push(`<span class="weather-badge">üåßÔ∏è –î–æ–∂–¥—å</span>`);

                weatherRow.innerHTML = active.length ? active.join('') : '<span class="weather-badge">‚òÄÔ∏è –Ø—Å–Ω–æ</span>';
            }

            endRound() {
                this.addToHistory(`üèÅ –†–∞—É–Ω–¥ ${this.round} –∑–∞–≤–µ—Ä—à—ë–Ω`);
                this.round++;
                this.cards = { melee: [], ranged: [], siege: [] };
                this.horn = { melee: false, ranged: false, siege: false };
                this.weather = { melee: false, ranged: false, siege: false };
                this.updateDisplay();
            }

            resetGame() {
                this.round = 1;
                this.cards = { melee: [], ranged: [], siege: [] };
                this.horn = { melee: false, ranged: false, siege: false };
                this.weather = { melee: false, ranged: false, siege: false };
                this.history = [];
                this.addToHistory('üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞');
                this.updateDisplay();
            }

            addToHistory(message) {
                const time = new Date().toLocaleTimeString().slice(0, 5);
                this.history.push(`${time}: ${message}`);
                if (this.history.length > 8) this.history.shift();

                const historyList = document.getElementById('historyList');
                historyList.innerHTML = this.history.map(msg =>
                    `<div class="history-item">${msg}</div>`
                ).join('');
            }
        }

        // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä—É
        const game = new GwentCounter();
        game.updateDisplay();

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function toggleAbility(type) { game.toggleAbility(type); }
        function addCard() { game.addCard(); }
        function removeCard(row, id) { game.removeCard(row, id); }
        function toggleCardDetails(id) { game.toggleCardDetails(id); }
        function toggleHorn(row) { game.toggleHorn(row); }
        function toggleWeather(row) { game.toggleWeather(row); }
        function endRound() { game.endRound(); }
        function resetGame() { game.resetGame(); }
    </script>
</body>
</html>
